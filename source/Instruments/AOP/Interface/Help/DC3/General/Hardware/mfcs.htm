<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<meta name="GENERATOR" content="Microsoft&reg; HTML Help Workshop 4.1">
<Title>Mass Flow Controllers</Title>
<link rel ="stylesheet" type="text/css" href="../../simple.css" />
</HEAD>
<BODY>
<h1>Communicating with the Controllers</h1>
<p> All communication with the controllers uses the RS-232 protocol.  The configuration for the Alicat controllers is:

	<table border = "1" vspace ="10">
	<caption><b>Table 2.</b> MFC communication parameters.</caption>
		<tr><td>Baud rate</td><td>19200</td></tr>
		<tr><td>Data bits</td><td>8</td></tr>
		<tr><td>Stop bits</td><td>1</td></tr>
		<tr><td>Parity</td><td>None</td></tr>		
		<tr><td>Flow Control</td><td>None</td></tr>
	</table>

To set up the MFC communication for the CRDS-PAS system, open National Instrument's MAX and select COM1 from under Remote Systems -> CRDS-PAS -> Devices and Interfaces -> Serial & Parallel -> COM1.  In the middle panel, ensure that the Settings are those in the above table.  Select the button "Open VISA Test Panel".  When a session is opened on the port, the user will see a window like the one below. Verify that the settings are correct.</p>

<div class="figure">
<p><b>Figure 1.</b> MAX test panel for configuring serial settings on the MFC port.</p>
<p><img src = "../IMG/visa_mfc_ser_set.jpg"/></p>
</div>

<p>Once the serial settings are correct, select the "I/O Settings" tab.  Each command sent to the conrtoller should be terminated with a carriage return (\r).  Also, we can identify the end of a string returned from the controller by locating the carriage return on a read.  To set the controller up for terminating reads and writes on the termination character, make sure that "Send End on Writes" is checked as well as "Enable Termination Character" under the portion of the panel labeled <b>Termination Methods</b>.  .  In addition, make sure that "TermChar" is selected for both "End Mode for Reads" and "End Mode for Writes".  Finally, select "Carriage Return - \r" for the value under "Termination Character".  Although not necessary, the user may wish to change the "Timeout (ms)" under <b>Standard Settings</b> to 100; this should give the controller plenty of time to respond and not cause a hangup if the controller does not respond appropriately.  Once all of the settings are correctly applied, press the button labeled "Apply Changes".  The final screen should look like the one below.</p>

<div class="figure">
<p><b>Figure 2.</b> MAX test panel for configuring the I/O settings on the MFC port.</p>
<p><img src = "../IMG/visa_mfc_io_set.jpg" /></p>
</div>

<p>Once the user has configured the settings for serial communication properly, select the button at the top of the VISA session labeled <b.Input/Output</b> (the new screen is shown in the image below).  Here the user will be able to send the appropriate commands to the controller as described below.</p>
<h3>Changing the Output Settings</h3>

<p>If the controllers do not respond as expected, it may be necessary to change the output settings on register 20.  Before attempting to do this , record the current output settings.  To retrieve the current output settings (stored in register 20), type in the <b>Basic I/O</b> window under "Select or Enter Command" <i>A$$R20</i> and then press the button "Query" .  The controller will respond with the value (after the = in the return string).  For the purposes of the DC3 work, the value of this register should be around 8960.

</BODY>
</HTML>
