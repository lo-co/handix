<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<meta name="GENERATOR" content="Microsoft&reg; HTML Help Workshop 4.1">
<link rel ="stylesheet" type="text/css" href="../simple.css" />
<Title>Humidity Control</Title>
</HEAD>
<BODY>
<h1>Humidity Control</h1>
<p>In both the PAS and the CRDS, there are channels in which the humidity is to be actively controlled.  In the PAS, this corresponds to the first channel and the relative humidity is to be maintained in the cell at ~80%.  In the CRDS, there are two cells which we will operate at two distinct temperatures - cells 7 and 8.  In these cells, the RH will be maintained at ~75% and >85%.  In each case, we desire to maintain the relative humidity in the cell of interest within ~1%.</p>
<p>To control the humidity, sample air is passed through a block for which the temperature is actively controlled using a thermoelectric cooler (TEC; Wavelength Electronics, WTC3243).  The sample passes through a line in the block which contains a Permapure humidifier.  The humidifier consists of two concentric tubes - the outer is stainless steel while the inner is a Nafion.  The sample passes through the Nafion tubing.  Water contained in the annular region created by the two tubes provides the water vapor source for humidification.  The amount of water vapor in the sample air is controlled primarily by the humidifier temperature. </p>
<h2>Temperature Control</h2>
<p>The temperature is controlled via an input voltage signal representing the desired temperature.  The voltage itself is twice the thermistor resistance at the given temperature.  The thermistor which provides the feedback to the TEC is the ON-930-44006 which provides a resistance of 10 k? at 25°C.  Conversion of the temperature to a resistance is based on the Steinhart-Hart equations and is:</p>
<p><img src="IMG\shh.jpg" vspace="5"></p>
<p>where </p>
<p><img src="IMG\shh_y.jpg" vspace="5"></p>
<p>and</p>
<p><img src="IMG\shh_x.jpg" vspace="5"></p>
<p>In the above equations, the coefficients are defined by the Steinhart-Hart equations for the given thermistor and are <i>A</i>=1.02919e<sup>-3</sup>, <i>B</i>=2.39128e<sup>-4</sup>, and <i>C</i>=1.56628e<sup>-7</sup>.</p>
<table id="hor-minimalist-a" summary="TEC Gains">
<caption>Table 1. TEC PI gain values. Gains (with R in parentheses)</caption>
    <thead>
    	<tr>
        	<th scope="col">Device</th>
            <th scope="col">P</th>
            <th scope="col">I</th>
        </tr>
    </thead>
    <tbody>
    	<tr><td>PAS</td><td>50 (50 k&Omega;)</td><td>0.53 (open)</td><tr>
	<tr><td>CRD</td><td>10 (10 k&Omega;)</td><td>0.53 (open)</td><tr>
</tbody></table>
<p>Once the temperature setpoint is provided to the controller, the TEC then uses a PI algorithm to control to maintain the temperature at the desired setpoint.  The gains for the proportional and integral terms of the controller are set via resistors in hardware.  As of April 2012, prior to deployment for DC3, all controllers were operating with the integral portion of the circuit open.  The values of the proportional resistors are 50 k&Omega; for the PAS and 10 k&Omega; for the two CRDS saturators.  Using equations provided by Wavelength Electronics, this gives gains of approximately 50 and 10 for the saturator TECs respectively.  With the open integral circuit, the gain for the integral term is 0.53.  All values are outlined in Table 1.</p>
<h2>Software Humidity Control</h2>
<p>If the saturator efficiency were 100% (i.e. the relative humidity at the outlet of the saturator were 100%, after adjusting for temperature), then all that would be necessary would be to set the temperature of the saturator to achieve the user defined relative humidity at the cell temperature based on the Clausius-Clapyeron equations.  However, the relative humidity in the cell will ultimately be defined by other parameters such as flow rate, pressure, environmental temperature, etc that may not be easily accounted for.  Because of these parameters, we use an in-software PID algorithm to control the relative humidity.</p>
<p>In the software, the relative humidity from the Vaisala probe in the cell in which we are trying to control humidity is provided to the Labview PID routine.  The error signal is then calculated as <i>e</i>= <i>RH<sub>set</sub></i>-<i>RH<sub>meas</sub></i>.  Using the error, the output of the PID controller is calculated as </p>
<p><img src="IMG\lv_pid.jpg" vspace="5"></p>
<p>Here, RH_meas is substituted for e in the derivative term to avoid derivative kick due to abrupt changes in the setpoint value.  Here, the integration and derivation are performed over the period t, which for the current use is set  to 2 s.  From the above implementation of the PID algorithm in Labview, it is clear that the proportional gain (<i>K<sub>c</sub></i>) has a direct impact on the integral (<i>K<sub>c</sub></i><i>T<sub>d</sub></i>) and derivative (<i>-K<sub>c</sub></i>&times;<i>T<sub>d</sub></i>) terms.  The output of this equation is 0 to 100%.  </p>
<p>Once the value <i>u</i>(<i>t</i>) is calculated, it is then translated to a temperature.  For the purposes of saturator control, we confine the temperature between air temperature (or dew point of the air <i>T<sub>d</sub></i>in the cell as specified by the user) and a minimum temperature defined by </p>
<p><img src="IMG\Tmin.jpg" vspace="5"></p>
<p>where the value T_sat is the saturator setpoint for a given RH.  Since the air enters the saturator at a warmer temperature than the saturator, the air entering must also be cooled by the saturator.  As it is unlikely that the air is cooled to the final TEC temperature setpoint, the air temperature exiting will likely be some combination of the air inlet and TEC temperature.  Given this, information, if we wish to hit the RH based on a theoretical calculation of temperature, we will have to drive the temperature of the saturator even lower.  The worst case scenario is that the outlet temperature will be the average of the inlet temperature and the TEC temperature.  </p>
<p>Using this, we can calculate the minimum temperature in the target range as above.   While this gives us a lower minimum than we likely need (we can probably start with a <i>T<sub>min</sub></i> of the theoretical temperature setpoint given that the required saturator temperature is likely to be higher than this), it still provides a reasonable range over which to adjust the temperature setpoint.  Finally, the controller output then corresponds to <i>T<sub>min</sub></i> at 0% and <i>T<sub>max</sub></i> at 100%.  Using this algorithm, as of April 2012 prior to the deployment for DC3, the PID parameters for the PAS controller was 5,1,2 and those for the CRDS were 10,1,2.</p>

</BODY>
</HTML>
